<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.waity.api.mapper.channelMapper">
    <select id="selectChannelAll" resultType="com.waity.api.dto.channelDTO">
		select
				*
		from
				yt_channel
    </select>
	<select id="selectChannelById" resultType="com.waity.api.dto.channelDTO">
		SELECT
				*
		FROM
				yt_channel
		WHERE
				id = #{id}
	</select>
    <select id="selectChannelByChannelId" resultType="com.waity.api.dto.channelDTO">
		SELECT
				*
		FROM
				yt_channel
		WHERE
				channel_id = #{channelId}
    </select>
    <select id="selectChannelByIds" resultType="com.waity.api.dto.channelDTO">
		select
				*
		from
				yt_channel
		WHERE
				id IN
				<foreach item="id" index="index" collection="array" open="(" close=")" separator=",">
					#{id}
				</foreach>
    </select>
    <select id="selectChannelByTags" resultType="com.waity.api.dto.channelDTO">
		SELECT
				A.id, A.channel_id, A.keyword, A.image, A.title, A.subscription_count, A.view_count, A.description
		FROM
				yt_channel A
		INNER JOIN
				yt_channel_tag B
		ON
				A.id = B.channel_id
		INNER JOIN
				yt_tag C
		ON
				C.id = B.tag_id
		WHERE
				C.tag_name IN
				<foreach item="tag" index="index" collection="array" open="(" close=")" separator=",">
					#{tag}
				</foreach>
		ORDER BY A.subscription_count DESC
    </select>
	<select id="selectChannelIdAll" resultType="String">
		select
				channel_id
		from
				yt_channel
	</select>
	<select id="getLastId" resultType="int">
		select
				max(id)
		from
				yt_channel
	</select>
    <insert id="insertChannel" parameterType="com.waity.api.dto.channelDTO" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO
			yt_channel (
				channel_id,
				keyword,
				image,
				title,
				subscription_count,
				view_count,
				description,
				video_count
			)
		VALUES(
				#{channelId},
				#{keyword},
				#{image},
				#{title},
			 	#{subscriptionCount},
			 	#{viewCount},
			 	#{description},
				#{videoCount}
			 )
	 	ON DUPLICATE KEY UPDATE
				keyword = #{keyword},
				image = #{image},
				title = #{title},
				subscription_count = #{subscriptionCount},
				view_count = #{viewCount},
				description = #{description}
    </insert>
	<insert id="insertChannels" parameterType="com.waity.api.dto.channelDTO">
		insert into
				yt_channel (channel_id, keyword, image, title, subscription_count, view_count, description, video_count)
		values
		<foreach collection="list" item="channel" open="(" close=")" separator="),(">
				#{channel.channelId},
				#{channel.keyword},
				#{channel.image},
				#{channel.title},
				#{channel.subscriptionCount},
				#{channel.viewCount},
				#{channel.description},
				#{channel.videoCount}
		</foreach>
		on duplicate key update
				channel_id = values(channel_id),
				keyword = values(keyword),
				image = values(image),
				title = values(title),
				subscription_count = values(subscription_count),
				view_count = values(view_count),
				description = values(description),
				video_count = values(video_count)
	</insert>
	<update id="updateChannel" parameterType="com.waity.api.dto.channelDTO">
		update
				yt_channel
		set
				channel_id = #{channelId},
				keyword = #{keyword},
				image = #{image},
				title = #{title},
				subscription_count = #{subscriptionCount},
				view_count = #{viewCount},
				description = #{description},
				video_count = #{videoCount}
		where
				id = #{id}
	</update>
	<delete id="deleteChannel" parameterType="int">
		delete from
				yt_channel
		where
				id = #{id}
	</delete>
	<insert id="insertChannelTags" parameterType="hashmap">
		insert into
				yt_channel_tag (channel_id, tag_id)
		values
		<foreach collection="tagIds" item="tagId" open="(" close=")" separator="),(">
				#{channelId},
				#{tagId}
		</foreach>
	</insert>
	<delete id="deleteChannelTags" parameterType="hashmap">
		delete from
				yt_channel_tag
		where
				channel_id = #{channelId}
		and
				tag_id in
		<foreach item="tagId" collection="tagIds" open="(" close=")" separator=",">
			#{tagId}
		</foreach>
	</delete>
</mapper>